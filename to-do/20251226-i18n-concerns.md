# Multi-Language Implementation Analysis (December 26, 2025)

## üîç **DEEP ANALYSIS: Multi-Language Implementation**

Based on codebase analysis, identified the scope and have **7 critical questions** before implementation.

### **üìä SCOPE ANALYSIS**

**Text Categories to Translate:**
1. **UI Labels** (~150+ strings): Button labels, section headers, form labels, tooltips
2. **System Messages** (~30+ strings): Alerts, confirmations, error messages, success notifications
3. **Kanji Data** (optional): Han-Viet meanings, JLPT level labels, category names
4. **Export Content**: PDF/PNG header/footer text, file naming
5. **Documentation**: Tooltips, help text, placeholder text

**Current Architecture:**
- 3-panel layout (mobile: tab-based, desktop: side-by-side)
- Redux state management
- No existing i18n infrastructure
- Hardcoded English/Vietnamese text mixed throughout components

---

## üéØ **7 CRITICAL QUESTIONS (Need answers before implementation)**

### **1. LANGUAGE SCOPE & PRIORITY**
Target audience is Vietnamese learners of Japanese. Questions:
- **Primary languages**: Vietnamese + English only, or plan for future expansion (Thai, Chinese, Korean)?
- **Kanji data translation**: Should Sino-Vietnamese readings stay as-is, or do you want English meanings too?
  - Example: Ë°å currently shows "H√ÄNH, H·∫†NH" - keep this for English users or add "to go, conduct"?
- **Mixed language UI**: Allow users to mix languages (e.g., Vietnamese UI but English tooltips)?

### **2. URL PARAMETER vs PERSISTENT STORAGE**
User mentioned `?lang=vi` URL parameter. Consider:
- **Conflict scenario**: What if URL says `?lang=en` but user's saved preference is Vietnamese?
- **First-time visitor**: No URL param, no saved preference - default to browser language or force selection?
- **SEO impact**: Do you want separate URLs for languages (impacts GitHub Pages deployment)?
- **Sharing worksheets**: If user shares a worksheet link, should language preference transfer?

### **3. MODE SWITCHER RELOCATION**
User wants to move Sheet/Board mode to global menu. This creates a problem:
- **Control Panel purpose**: Currently 40% of Control Panel is mode-related settings. If we move mode switcher to top, what happens to Board-specific settings (Empty Cells, Column Count 4-16 vs 4-10)?
- **Sheet mode incomplete**: Sheet mode is a placeholder. Should we:
  - Complete Sheet mode before adding i18n?
  - Hide Sheet mode and only show Board mode?
  - Keep mode switcher in Control Panel for now?

### **4. TOP MENU BAR REAL ESTATE**
On mobile (< 768px), limited space. Current layout:
- Mobile: 3 tabs (Input | Main | Control) fill entire width
- Adding a global menu bar means:
  - **Option A**: Menu bar above tabs (loses vertical space on small screens)
  - **Option B**: Menu icon in tab bar (replaces one tab?)
  - **Option C**: Hamburger menu overlay

**Question**: What's more important - quick language switching or keeping current mobile UX?

### **5. TRANSLATION MAINTENANCE**
Who translates? How do you handle:
- **New features**: Add a button ‚Üí needs translation in 2+ languages before launch?
- **Translation quality**: Use Google Translate, hire translator, community contributions?
- **Incomplete translations**: Show English fallback, show translation key, or hide feature?
- **Update frequency**: Real-time switching vs page reload required?

### **6. FONT & RTL CONSIDERATIONS**
- **Vietnamese**: Latin script with diacritics (√°, ƒÉ, ∆°, etc.) - current fonts support this?
- **Future languages**: If adding Arabic/Hebrew (RTL), entire layout needs mirroring
- **Font loading**: Additional fonts for Thai/Chinese would increase bundle size significantly

**Question**: Stick to Latin-script languages only (simpler), or architect for any language from day 1 (complex)?

### **7. EXPORT FILENAME & CONTENT LANGUAGE**
Current export: `kanji-list-2025-12-26.txt`, footer: "Generated by Fong Thai Kanji App on..."
- Should exported PDF filename be translated? (`danh-sach-kanji-2025-12-26.txt` in Vietnamese)
- Should footer text auto-translate based on UI language?
- What if user switches language mid-session - re-export changes footer language?

---

## üé® **7 ARCHITECTURE OPTIONS**

### **Option 1: React Context + JSON (Best Practice - Simple)**
```
src/i18n/
  ‚îú‚îÄ‚îÄ locales/
  ‚îÇ   ‚îú‚îÄ‚îÄ en.json
  ‚îÇ   ‚îî‚îÄ‚îÄ vi.json
  ‚îú‚îÄ‚îÄ i18nContext.tsx
  ‚îî‚îÄ‚îÄ useTranslation.ts
```
**Pros**: Zero dependencies, full control, easy to understand
**Cons**: Manual implementation, no pluralization/interpolation helpers

### **Option 2: react-i18next (Industry Standard)**
```bash
npm install react-i18next i18next
```
**Pros**: Battle-tested, lazy loading, interpolation, plurals, namespace support
**Cons**: 40KB bundle size, learning curve, overkill for 2 languages

### **Option 3: next-intl / react-intl (Format.js)**
**Pros**: ICU message format, date/number formatting, TypeScript-first
**Cons**: Not designed for Vite (Next.js-focused), heavyweight

### **Option 4: Custom Hook + URL State**
Store language in URL query param + `useState`:
```tsx
const [lang, setLang] = useQueryParam('lang', 'vi');
```
**Pros**: Shareable links, dead simple
**Cons**: No persistence without localStorage combo

### **Option 5: Redux Slice for Language**
Add `languageSlice.ts` to existing Redux store
**Pros**: Fits your architecture, centralized state, DevTools debugging
**Cons**: Redux boilerplate for simple feature

### **Option 6: Polyglot.js (Lightweight)**
8KB library, just for interpolation:
```tsx
polyglot.t('hello', { name: 'Fong' }) // "Xin ch√†o Fong"
```
**Pros**: Tiny, simple API
**Cons**: Still need to manage language switching yourself

### **Option 7: Hybrid (Recommended)**
**Redux slice + JSON locale files + custom hook**
- Language state in Redux (persisted to localStorage)
- Translation files as JSON modules
- `useTranslation()` hook wraps Redux selector
- URL param overrides Redux on mount
- Falls back to browser language ‚Üí Vietnamese default

---

## üé≠ **UI/UX OPTIONS** (Need layout clarification first)

Will provide 6 detailed mockup options once clarified:
1. Do you want persistent top menu bar?
2. Keep mode switcher in Control Panel or move it?
3. Mobile: overlay menu or inline?

---

## ‚ö†Ô∏è **RISKS & BLINDSPOTS**

1. **Test suite dependency**: All E2E tests use English text selectors (`getByText('Export')`) - need data-testid attributes
2. **PDF export fonts**: React-PDF needs font files registered for Vietnamese diacritics (√°, ∆°, ∆∞)
3. **IndexedDB data**: If you translate category names ("Actions" ‚Üí "H√†nh ƒë·ªông"), need migration
4. **Dynamic font loading**: `FontSizeControl` loads fonts dynamically - font names translatable?
5. **Keyboard shortcuts**: Paginator uses `Home/End` - these labels need translation
6. **Error boundaries**: Crash messages currently hardcoded
7. **Browser language detection**: `navigator.language` returns `vi-VN` or `vi` - both need handling

---

## üöÄ **RECOMMENDATION**

**WAIT** - Don't implement yet. Answer the 7 questions first, because:
- If Sheet mode is staying incomplete, don't move mode switcher
- If only 2 languages forever, skip react-i18next
- If kanji data needs translation, that's 3000+ entries (massive scope change)
- If mobile UX is priority, top menu bar might be wrong approach

**Suggested Order**:
1. Answer my 7 questions
2. I'll propose 3 concrete UI mockups based on your answers
3. You pick one
4. I'll create implementation plan with test strategy
5. We implement incrementally with tests after each step

**Next Steps**:
- A) Answer the 7 questions now
- B) See UI mockups first (I'll make assumptions)
- C) Start with minimal implementation (Vietnamese + English, keep current layout, manual JSON)

---

## üìù **STATUS**

**User Decision**: Postponed i18n implementation to work on Sheet Mode completion first.

This is the right priority - Sheet mode needs to be functional before adding i18n complexity. Will revisit this document after Sheet mode is complete.
